name: Deploy AutoDBFirstName Database

on:
  workflow_dispatch:  # Manual trigger

jobs:
  deploy-dev:
    uses: ./.github/workflows/deploy-sql.yml  # Call the reusable workflow
    with:
      environment: Dev
      sql_server_host: ${{ secrets.DEV_SQL_SERVER_HOST }}
      sql_user: ${{ secrets.DEV_SQL_USER }}
      sql_password: ${{ secrets.DEV_SQL_PASSWORD }}
    secrets:  # Explicitly pass secrets to the reusable workflow
      DEV_SQL_SERVER_HOST: ${{ secrets.DEV_SQL_SERVER_HOST }}
      DEV_SQL_USER: ${{ secrets.DEV_SQL_USER }}
      DEV_SQL_PASSWORD: ${{ secrets.DEV_SQL_PASSWORD }}

  deploy-prod:
    needs: deploy-dev  # Runs after Dev deployment
    uses: ./.github/workflows/deploy-sql.yml  # Call the reusable workflow
    with:
      environment: Prod
      sql_server_host: ${{ secrets.PROD_SQL_SERVER_HOST }}
      sql_user: ${{ secrets.PROD_SQL_USER }}
      sql_password: ${{ secrets.PROD_SQL_PASSWORD }}
    secrets:  # Explicitly pass secrets to the reusable workflow
      PROD_SQL_SERVER_HOST: ${{ secrets.PROD_SQL_SERVER_HOST }}
      PROD_SQL_USER: ${{ secrets.PROD_SQL_USER }}
      PROD_SQL_PASSWORD: ${{ secrets.PROD_SQL_PASSWORD }}
